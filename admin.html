<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Di Di Coffee</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .admin-box { background: rgba(255, 255, 255, 0.9); padding: 20px; border-radius: 15px; margin-bottom: 20px; color: #4e342e; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        button { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-search { background: #6d4c41; color: white; }
        .btn-add { background: #4caf50; color: white; }
        .btn-sub { background: #f44336; color: white; }
        .info-display { background: #efebe9; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 5px solid #6d4c41; }
    </style>
</head>
<body>
    <div class="card">
        <h2 id="shopTitle">‚öôÔ∏è QU·∫¢N TR·ªä DI DI</h2>
        
        <div id="admin-login">
            <input type="password" id="adminPass" placeholder="Nh·∫≠p m√£ b·∫£o m·∫≠t Admin">
            <button class="btn-search" onclick="login()">V√ÄO QU·∫¢N TR·ªä</button>
        </div>

        <div id="admin-panel" style="display:none;">
            <div class="admin-box">
                <label>Tra c·ª©u S·ªë ƒëi·ªán tho·∫°i:</label>
                <input type="tel" id="searchPhone" placeholder="090...">
                <button class="btn-search" onclick="fetchCustomer()">T√åM KH√ÅCH H√ÄNG</button>
                
                <div id="customerDetails" style="display:none;" class="info-display">
                    <p>Kh√°ch: <strong id="detName">...</strong></p>
                    <p>ƒêi·ªÉm: <strong id="detPoints" style="font-size: 24px; color: #d84315;">0</strong></p>
                    <p>L∆∞·ª£t quay: <strong id="detSpins">0</strong></p>
                </div>
            </div>

            <div class="admin-box">
                <h4>Thao t√°c ƒëi·ªÉm & Qu√†</h4>
                <input type="number" id="pointAmount" placeholder="S·ªë ƒëi·ªÉm (v√≠ d·ª•: 1 ho·∫∑c 20)">
                <div class="btn-group">
                    <button class="btn-add" onclick="updateData('add')">‚ûï C·ªòNG ƒêI·ªÇM</button>
                    <button class="btn-sub" onclick="updateData('sub')">üéÅ ƒê·ªîI QU√Ä (-)</button>
                </div>
            </div>
            
            <div class="admin-box">
                <h4>V√≤ng quay</h4>
                <button class="btn-search" style="width:100%" onclick="updateData('add_spin')">‚ûï T·∫∂NG 1 L∆Ø·ª¢T QUAY</button>
            </div>
        </div>

        <div id="adminResult" style="margin-top:15px"></div>
    </div>

    <script src="config.js"></script>
    <script>
        // M·∫≠t kh·∫©u v√†o admin ƒë∆°n gi·∫£n (B·∫°n c√≥ th·ªÉ ƒë·ªïi ·ªü ƒë√¢y)
        function login() {
            const pass = document.getElementById('adminPass').value;
            if(pass === "1234") { // Thay 1234 b·∫±ng pass b·∫°n mu·ªën
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
            } else {
                alert("Sai m√£ b·∫£o m·∫≠t!");
            }
        }

        function fetchCustomer() {
            const phone = document.getElementById('searchPhone').value.trim();
            if(!phone) return alert("Ch∆∞a nh·∫≠p SƒêT");

            const resDiv = document.getElementById('adminResult');
            resDiv.innerHTML = "‚åõ ƒêang t√¨m...";

            fetch(`${CONFIG.SCRIPT_URL}?action=get_customer&phone=${phone}`)
                .then(res => res.json())
                .then(data => {
                    if(data.status === "SUCCESS") {
                        document.getElementById('customerDetails').style.display = 'block';
                        document.getElementById('detName').innerText = data.name;
                        document.getElementById('detPoints').innerText = data.points;
                        document.getElementById('detSpins').innerText = data.spins || 0;
                        resDiv.innerHTML = "";
                    } else {
                        resDiv.innerHTML = "‚ùå Kh√¥ng t√¨m th·∫•y kh√°ch n√†y.";
                    }
                });
        }

        function updateData(mode) {
            const phone = document.getElementById('searchPhone').value.trim();
            const amount = document.getElementById('pointAmount').value || 1;
            const resDiv = document.getElementById('adminResult');

            resDiv.innerHTML = "‚åõ ƒêang x·ª≠ l√Ω...";

            fetch(`${CONFIG.SCRIPT_URL}?action=admin_update&mode=${mode}&phone=${phone}&amount=${amount}`)
                .then(res => res.json())
                .then(data => {
                    if(data.status === "SUCCESS") {
                        resDiv.innerHTML = "‚úÖ Th√†nh c√¥ng!";
                        fetchCustomer(); // Reload l·∫°i th√¥ng tin m·ªõi
                    } else {
                        resDiv.innerHTML = "‚ùå L·ªói: " + data.message;
                    }
                });
        }
    </script>
</body>
</html>